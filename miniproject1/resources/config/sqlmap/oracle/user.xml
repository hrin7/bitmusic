<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.bitmusic.mapper.UserMapper">

  <resultMap id = "userMap" type = "user">
      <result column = "id" property = "id" />
      <result column = "password" property = "password" />
      <result column = "password_hint" property = "passwordHint" />
      <result column = "name" property = "name" />
      <result column = "age" property = "age" />
      <result column = "gender" property = "gender" />
      <result column = "email" property = "email" />
      <result column = "join_date" property = "joinDate" />
   </resultMap>

   <select id = "selectUser" resultMap = "userMap" >
      select a.*, 
      (select from)
      from tb_user a
      where join_date = to_char(join_date, 'yyyy-MM-dd')
      order by id
   </select>
   
   <insert id = "insertUser" parameterType = "user">
      insert into tb_user (
      id, password, password_hint, name, age, gender, email
      ) values (
      #{id}, #{password}, #{passwordHint}, #{name}, #{age}, #{gender}, #{email})
   </insert>
   
   <update id = "updateUser" parameterType = "search">
      update tb_user
      set 
       <choose>
          <when test="searchType == 'id'">
             id = #{id}
          </when>
          <when test="searchType == 'password'">
             password = #{password}
          </when>
          <when test="searchType == 'password_hint'">
             password_hint = #{password_hint}
          </when>
          <when test="searchType == 'name'">
             name = #{name}
          </when>
          <when test="searchType == 'age'">
             age = #{age}
          </when>
          <when test="searchType == 'gender'">
             gender = #{gender}
          </when>
          <when test="searchType == 'email'">
             email = #{email}
          </when>
       </choose>
            where id = #{id}
   </update>
   
   <delete id = "deleteUser" parameterType = "string">
      delete from tb_user
      where id = #{id}
   </delete>
   
   <select id="loginUser" parameterType="user" resultMap="userMap">
   		select id, password
   		  from tb_user
   		 where id = #{id}
   		   and password = #{password}
   </select>

</mapper>